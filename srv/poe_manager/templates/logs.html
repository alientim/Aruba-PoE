{% extends "base.html" %}
{% block content %}

<h2>Live Log</h2>

<div id="log-container">
    <div id="log-box"></div>
    <div id="refresh-timer">
        NÃ¤chstes Update in <span id="timer"></span> Sekunden
    </div>
</div>

<script>
const intervalMinutes = {{ interval | int }};
const intervalMilliseconds = intervalMinutes * 60 * 1000;
let lastUpdateTime = Date.now();

function fetchLog() {
    fetch("{{ url_for('get_log') }}")
        .then(response => response.text())
        .then(data => {
            const box = document.getElementById("log-box");
            const filteredLines = data
                .split("\n")
                .filter(line => !line.includes("ist erreichbar!"))
                .join("\n");
            box.innerText = filteredLines;
            box.scrollTop = box.scrollHeight;
            lastUpdateTime = Date.now();
        })
        .catch(err => console.error("Fehler beim Laden der Logs:", err));
}

function updateTimer() {
    const now = Date.now();
    const remainingMs = intervalMilliseconds - (now - lastUpdateTime);
    const remainingSec = Math.max(Math.ceil(remainingMs / 1000), 0);
    document.getElementById("timer").innerText = remainingSec;
}

setInterval(updateTimer, 1000);
fetchLog();
setInterval(fetchLog, intervalMilliseconds);
</script>

{% endblock %}
